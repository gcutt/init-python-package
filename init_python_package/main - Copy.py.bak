import os
from pathlib import Path

FOLDERS = ["data", "notebooks", "scripts", "tests"]

REQUIREMENTS = """# Project dependencies
pathlib
#numpy
#pandas
#python-dateutil
#pytz
#scipy
#fastapi
#uvicorn
"""

GITIGNORE = """# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*.pyo
*.pyd

# Virtual environments
.venv/
env/
venv/

# Distribution / packaging
build/
dist/
*.egg-info/

# Jupyter Notebook checkpoints
.ipynb_checkpoints/

# Logs
*.log

# OS files
.DS_Store
Thumbs.db
"""

BASH_SCRIPT = """#!/bin/bash
python3.12 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
"""

BAT_SCRIPT = """@echo off
python3.12 -m venv .venv
call .venv\\Scripts\\activate
pip install --upgrade pip
pip install -r requirements.txt
"""

INIT_PY = """\"\"\"Top-level package for {pkgname}.\"\"\""""

PACKAGE_MAIN = """def hello_world():
    \"\"\"Example function to demonstrate project structure.\"\"\" 
    return "Hello, world!"

def main():
    message = hello_world()
    print(message)

if __name__ == "__main__":
    main()
"""

TEST_SCRIPT = """import unittest
from {pkgname}.main import hello_world

class TestMain(unittest.TestCase):
    def test_hello_world(self):
        self.assertEqual(hello_world(), "Hello, world!")

if __name__ == "__main__":
    unittest.main()
"""

PYPROJECT = """[build-system]
requires = ["setuptools", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "{pkgname}"
version = "0.1.0"
description = "A Python package scaffold"
authors = [{{ name = "Your Name" }}]
readme = "README.md"
dependencies = []
"""

# Simplified README template
README = """# {pkgname}

A Python package scaffold generated by init-python-package.
"""

def main():
    project_path_input = input("Enter the full path where you want to create the new package: ").strip()
    project_root = Path(project_path_input)

    project_root.mkdir(parents=True, exist_ok=False)
    print(f"Initializing package in: {project_root.resolve()}")

    pkgname = project_root.name.replace("-", "_")

    for folder in FOLDERS:
        path = project_root / folder
        path.mkdir(exist_ok=True)
        print(f"Created folder: {path}")

    pkg_path = project_root / pkgname
    pkg_path.mkdir(exist_ok=True)
    print(f"Created package folder: {pkg_path}")

    (pkg_path / "__init__.py").write_text(INIT_PY.format(pkgname=pkgname))
    (pkg_path / "main.py").write_text(PACKAGE_MAIN)

    (project_root / "tests" / "test_main.py").write_text(TEST_SCRIPT.format(pkgname=pkgname))

    (project_root / "requirements.txt").write_text(REQUIREMENTS)
    (project_root / ".gitignore").write_text(GITIGNORE)
    (project_root / "pyproject.toml").write_text(PYPROJECT.format(pkgname=pkgname))
    (project_root / "README.md").write_text(README.format(pkgname=pkgname))

    (project_root / "setup_env.sh").write_text(BASH_SCRIPT)
    os.chmod(project_root / "setup_env.sh", 0o755)
    (project_root / "setup_env.bat").write_text(BAT_SCRIPT)

    print("âœ… Package initialized successfully!")

if __name__ == "__main__":
    main()